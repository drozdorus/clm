<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compare Auto Insurance Quotes - ThePolicy</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Логотип */
        .logo {
            text-align: center;
            margin-bottom: 20px;
        }

        .logo h1 {
            color: white;
            font-size: 2rem;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .logo .motto {
            color: rgba(255,255,255,0.9);
            font-size: 1rem;
            font-weight: 400;
            margin-top: 5px;
            font-style: italic;
        }

        /* Cookie Notification */
        .cookie-notification {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            font-size: 0.9rem;
            z-index: 9999;
            display: none;
            animation: slideUp 0.3s ease;
        }

        .cookie-notification.show {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
        }

        .cookie-notification p {
            margin: 0;
            flex: 1;
        }

        .cookie-notification button {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .progress-container {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            padding: 5px;
            margin-bottom: 30px;
        }

        .progress-bar {
            height: 8px;
            background: #4CAF50;
            border-radius: 25px;
            width: 33.33%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            color: white;
            margin-top: 10px;
            font-weight: 500;
        }

        .quiz-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .quiz-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .quiz-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .quiz-header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .step {
            display: none;
            padding: 40px 30px;
            min-height: 400px;
        }

        .step.active {
            display: block;
        }

        .step-content h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            text-align: center;
        }

        .step-content p {
            font-size: 1.1rem;
            color: #666;
            text-align: center;
            margin-bottom: 30px;
        }

        .input-group {
            text-align: center;
            max-width: 400px;
            margin: 0 auto;
        }

        .input-group input {
            width: 100%;
            padding: 15px 20px;
            font-size: 1.2rem;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            margin-bottom: 20px;
            text-align: center;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .options-group {
            display: grid;
            gap: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .option-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .option-card:hover {
            transform: translateY(-3px);
            border-color: #667eea;
        }

        .option-card.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .option-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .option-card h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .option-card p {
            color: #666;
            margin: 0;
        }

        .option-card.selected p {
            color: rgba(255, 255, 255, 0.9);
        }

        .bundle-highlight {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border-color: #4CAF50;
        }

        .bundle-highlight p {
            color: rgba(255, 255, 255, 0.9);
        }

        .discount-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #ff4757;
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* РЕЗУЛЬТАТИ */
        .results-content {
            padding: 40px 30px;
        }

        .results-content h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            text-align: center;
            color: #333;
        }

        .results-subtext {
            font-size: 1.1rem;
            color: #666;
            text-align: center;
            margin-bottom: 20px;
        }

        /* Summary Box */
        .results-summary {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #dee2e6;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
        }

        .results-summary h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .summary-details {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .summary-item {
            background: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #555;
            border: 1px solid #ddd;
        }

        /* Інсентив бокс */
        .incentive-box {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0 30px 0;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }

        .incentive-box h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .incentive-box p {
            margin: 0;
            opacity: 0.95;
        }

        .offers-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .offer-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .offer-card:hover {
            transform: translateY(-3px);
            border-color: #667eea;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .offer-card.featured {
            border-color: #4CAF50;
            background: linear-gradient(135deg, #f8fff8 0%, #e8f5e8 100%);
        }

        .featured-badge {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: #4CAF50;
            color: white;
            padding: 5px 20px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .company-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .rating {
            font-size: 0.9rem;
            color: #ffc107;
            margin-bottom: 15px;
        }

        .price-estimate {
            font-size: 2rem;
            font-weight: 700;
            color: #4CAF50;
            margin-bottom: 5px;
        }

        .price-note {
            font-size: 0.8rem;
            color: #999;
            margin-bottom: 15px;
        }

        .features {
            list-style: none;
            text-align: left;
            margin-bottom: 20px;
        }

        .features li {
            padding: 5px 0;
            color: #666;
            position: relative;
            padding-left: 20px;
        }

        .features li:before {
            content: "✓";
            color: #4CAF50;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        .features li.highlight {
            color: #ff4757;
            font-weight: 600;
        }

        .features li.highlight:before {
            content: "🔥";
        }

        .btn-offer {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s ease;
        }

        .btn-offer:hover {
            transform: translateY(-2px);
        }

        .disclaimer {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            text-align: center;
        }

        .disclaimer p {
            font-size: 0.9rem;
            color: #666;
            margin: 0;
        }

        /* Footer */
        .footer {
            margin-top: 40px;
            padding: 20px 0;
            text-align: center;
            border-top: 1px solid rgba(255,255,255,0.2);
        }

        .footer p {
            color: rgba(255,255,255,0.8);
            font-size: 0.8rem;
            margin: 5px 0;
        }

        .footer a {
            color: rgba(255,255,255,0.9);
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        .error-message {
            background: #ff4757;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            margin-top: 10px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .container { padding: 10px; }
            .logo h1 { font-size: 1.7rem; }
            .quiz-header h1 { font-size: 2rem; }
            .step { padding: 30px 20px; }
            .offers-container { grid-template-columns: 1fr; }
            .results-content { padding: 30px 20px; }
            .incentive-box { padding: 15px; }
            .cookie-notification { 
                left: 10px; 
                right: 10px; 
                flex-direction: column; 
                gap: 10px; 
            }
            .summary-details { 
                flex-direction: column; 
                gap: 10px; 
            }
        }
    </style>
</head>
<body>
    <!-- Cookie Notification -->
    <div class="cookie-notification" id="cookieNotification">
        <p>We use cookies to save your quiz progress and improve your experience.</p>
        <button onclick="acceptCookies()">OK</button>
    </div>

    <div class="container">
        <!-- Логотип -->
        <div class="logo">
            <h1>ThePolicy</h1>
            <div class="motto">You deserve better policies</div>
        </div>

        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
            <div class="progress-text">
                <span id="currentStep">1</span> of 3
            </div>
        </div>

        <div class="quiz-container">
            <div class="quiz-header">
                <h1>Find Your Perfect Auto Insurance</h1>
                <p>Compare quotes from top providers and save up to 50%</p>
            </div>

            <!-- Step 1: ZIP -->
            <div class="step active" id="step1">
                <div class="step-content">
                    <h2>What's your zip code?</h2>
                    <p>We'll find the best rates in your area</p>
                    <div class="input-group">
                        <input type="text" id="zipCode" placeholder="Enter your zip code" maxlength="5">
                        <button class="btn-primary" id="zipBtn" onclick="goToStep2()" disabled>Enter 5-digit zip code</button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Insurance -->
            <div class="step" id="step2">
                <div class="step-content">
                    <h2>Are you currently insured?</h2>
                    <p>This helps us find better rates for you</p>
                    <div class="options-group">
                        <div class="option-card" onclick="selectInsured('yes')">
                            <div class="option-icon">✅</div>
                            <h3>Yes, I'm insured</h3>
                            <p>I want to compare my current rate</p>
                        </div>
                        <div class="option-card" onclick="selectInsured('no')">
                            <div class="option-icon">❌</div>
                            <h3>No, I need insurance</h3>
                            <p>I'm looking for my first policy</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Bundle -->
            <div class="step" id="step3">
                <div class="step-content">
                    <h2>Bundle car + home insurance?</h2>
                    <p>Get up to 50% discount when you bundle</p>
                    <div class="options-group">
                        <div class="option-card bundle-highlight" onclick="selectBundle('yes')">
                            <div class="option-icon">🏠🚗</div>
                            <h3>Yes, bundle both</h3>
                            <p>Save up to 50% with bundled coverage</p>
                            <div class="discount-badge">Best Deal!</div>
                        </div>
                        <div class="option-card" onclick="selectBundle('no')">
                            <div class="option-icon">🚗</div>
                            <h3>Car insurance only</h3>
                            <p>Just auto insurance for now</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- РЕЗУЛЬТАТИ -->
        <div class="quiz-container" id="resultsContainer" style="display: none; margin-top: 20px;">
            <div class="results-content">
                <h2>🎉 Your Best Matches</h2>
                <p class="results-subtext">Based on your answers, here are the top-rated providers in your area</p>
                
                <!-- Results Summary -->
                <div class="results-summary">
                    <h3>Your Selection Summary</h3>
                    <div class="summary-details">
                        <div class="summary-item" id="zipSummary">ZIP: ----</div>
                        <div class="summary-item" id="insuranceSummary">Insurance: ----</div>
                        <div class="summary-item" id="bundleSummary">Coverage: ----</div>
                    </div>
                </div>
                
                <!-- Інсентив блок -->
                <div class="incentive-box">
                    <h3>💡 Important: Get Your Exact Quote!</h3>
                    <p>These are estimated rates based on your profile. <strong>Click each offer below</strong> to get your personalized quote with exact pricing for your specific vehicle, driving history, and coverage needs!</p>
                </div>
                
                <div class="offers-container">
                    <!-- GEICO with No Downpayment -->
                    <div class="offer-card featured" onclick="openOffer('geico')">
                        <div class="featured-badge">Most Popular</div>
                        <div class="company-name">GEICO</div>
                        <div class="rating">⭐⭐⭐⭐⭐ 4.9/5</div>
                        <div class="price-estimate" data-auto="35" data-bundle="55">$35/month</div>
                        <div class="price-note">*Prices start from</div>
                        <ul class="features">
                            <li class="highlight">No down payment required</li>
                            <li>15% savings for government employees</li>
                            <li>Easy online claims process</li>
                            <li>24/7 emergency roadside assistance</li>
                        </ul>
                        <button class="btn-offer">Get Your Exact Quote →</button>
                    </div>

                    <!-- Progressive -->
                    <div class="offer-card" onclick="openOffer('progressive')">
                        <div class="company-name">Progressive</div>
                        <div class="rating">⭐⭐⭐⭐⭐ 4.8/5</div>
                        <div class="price-estimate" data-auto="39" data-bundle="59">$39/month</div>
                        <div class="price-note">*Avg. expenditure</div>
                        <ul class="features">
                            <li>24/7 customer support</li>
                            <li>Mobile app discounts</li>
                            <li>Accident forgiveness program</li>
                            <li>Name your price tool</li>
                        </ul>
                        <button class="btn-offer">Get Your Exact Quote →</button>
                    </div>

                    <!-- State Farm -->
                    <div class="offer-card" onclick="openOffer('statefarm')">
                        <div class="company-name">State Farm</div>
                        <div class="rating">⭐⭐⭐⭐⭐ 4.7/5</div>
                        <div class="price-estimate" data-auto="42" data-bundle="63">$42/month</div>
                        <div class="price-note">*Starting price</div>
                        <ul class="features">
                            <li>Local agent support</li>
                            <li>Good student discounts</li>
                            <li>Multi-policy savings</li>
                            <li>Drive Safe & Save program</li>
                        </ul>
                        <button class="btn-offer">Get Your Exact Quote →</button>
                    </div>

                    <!-- Allstate -->
                    <div class="offer-card" onclick="openOffer('allstate')">
                        <div class="company-name">Allstate</div>
                        <div class="rating">⭐⭐⭐⭐ 4.6/5</div>
                        <div class="price-estimate" data-auto="45" data-bundle="67">$45/month</div>
                        <div class="price-note">*Estimated cost</div>
                        <ul class="features">
                            <li>Drivewise rewards program</li>
                            <li>New car replacement coverage</li>
                            <li>Safe driving bonuses</li>
                            <li>Claim-free rewards</li>
                        </ul>
                        <button class="btn-offer">Get Your Exact Quote →</button>
                    </div>
                </div>

                <div class="disclaimer">
                    <p>*Estimated rates based on your profile. Actual rates may vary and depend on your specific vehicle, driving record, credit score, and coverage selections. Click each offer to get your personalized quote with exact pricing.</p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p><a href="#cookie-policy">Cookie Policy</a> | By continuing to use this site, you agree to our use of cookies.</p>
            <p>&copy; 2025 ThePolicy. Connecting you with better insurance options.</p>
        </div>
    </div>

    <script>
        // Збереження даних
        let quizData = { zipCode: '', insured: '', bundle: '', currentStep: 1 };

        // Афіліатні посилання - ЗАМІНІТЬ НА СВОЇ!
        const affiliateLinks = {
            progressive: 'https://www.progressive.com/?affiliate_id=YOUR_PROGRESSIVE_ID',
            geico: 'https://www.geico.com/?affiliate_id=YOUR_GEICO_ID', 
            statefarm: 'https://www.statefarm.com/?affiliate_id=YOUR_STATEFARM_ID',
            allstate: 'https://www.allstate.com/?affiliate_id=YOUR_ALLSTATE_ID'
        };

        // Cookie функції
        function setCookie(name, value, days) {
            const expires = new Date(Date.now() + days * 24 * 60 * 60 * 1000).toUTCString();
            document.cookie = `${name}=${encodeURIComponent(value)};expires=${expires};path=/`;
        }

        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for(let i = 0; i < ca.length; i++) {
                let c = ca[i].trim();
                if (c.indexOf(nameEQ) == 0) {
                    return decodeURIComponent(c.substring(nameEQ.length));
                }
            }
            return null;
        }

        // Збереження прогресу
        function saveProgress() {
            setCookie('quizProgress', JSON.stringify(quizData), 7); // 7 днів
        }

        // Відновлення прогресу
        function restoreProgress() {
            const saved = getCookie('quizProgress');
            if (saved) {
                try {
                    const savedData = JSON.parse(saved);
                    quizData = {...quizData, ...savedData};
                    
                    // Відновити поля
                    if (quizData.zipCode) {
                        document.getElementById('zipCode').value = quizData.zipCode;
                        document.getElementById('zipBtn').disabled = false;
                        document.getElementById('zipBtn').textContent = 'Continue';
                    }
                    
                    // Відновити крок
                    if (quizData.currentStep > 1) {
                        document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
                        
                        if (quizData.currentStep === 4) { // Результати
                            showResults();
                        } else {
                            document.getElementById('step' + quizData.currentStep).classList.add('active');
                            updateProgress(quizData.currentStep);
                        }
                    }
                    
                    console.log('Progress restored:', quizData);
                } catch (e) {
                    console.log('Error restoring progress:', e);
                }
            }
        }

        // Cookie notification
        function showCookieNotification() {
            const accepted = getCookie('cookiesAccepted');
            if (!accepted) {
                document.getElementById('cookieNotification').classList.add('show');
            }
        }

        function acceptCookies() {
            setCookie('cookiesAccepted', 'true', 365);
            document.getElementById('cookieNotification').classList.remove('show');
        }

        // Валідація ZIP коду для США
        function isValidUSZipCode(zipCode) {
            if (!/^\d{5}$/.test(zipCode)) return false;
            
            const zip = parseInt(zipCode);
            if (zip < 1 || zip > 99999) return false;
            
            const invalidRanges = [
                [1, 299], [213, 214], [269, 269], [34997, 34998], 
                [69999, 69999], [80000, 80099], [88000, 88999], 
                [96200, 96299], [96600, 96999]
            ];
            
            for (let range of invalidRanges) {
                if (zip >= range[0] && zip <= range[1]) return false;
            }
            
            return true;
        }

        // Крок 1 → 2
        function goToStep2() {
            const zipCode = document.getElementById('zipCode').value;
            
            if (!isValidUSZipCode(zipCode)) {
                showError('Please enter a valid US zip code');
                return;
            }
            
            quizData.zipCode = zipCode;
            quizData.currentStep = 2;
            saveProgress();
            
            document.getElementById('step1').classList.remove('active');
            document.getElementById('step2').classList.add('active');
            updateProgress(2);
        }

        // Крок 2 → 3
        function selectInsured(value) {
            quizData.insured = value;
            quizData.currentStep = 3;
            saveProgress();
            
            document.querySelectorAll('#step2 .option-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.option-card').classList.add('selected');
            
            setTimeout(() => {
                document.getElementById('step2').classList.remove('active');
                document.getElementById('step3').classList.add('active');
                updateProgress(3);
            }, 800);
        }

        // Крок 3 → Результати
        function selectBundle(value) {
            quizData.bundle = value;
            quizData.currentStep = 4;
            saveProgress();
            
            document.querySelectorAll('#step3 .option-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.option-card').classList.add('selected');
            
            setTimeout(() => {
                showResults();
            }, 800);
        }

        // Показати результати
        function showResults() {
            console.log('Showing results...');
            
            document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
            document.getElementById('resultsContainer').style.display = 'block';
            updateProgress(3, true);
            
            // Оновити summary
            updateResultsSummary();
            
            // Оновити ціни
            updatePricing();
            
            setTimeout(() => {
                document.getElementById('resultsContainer').scrollIntoView({ 
                    behavior: 'smooth' 
                });
            }, 100);
        }

        // Оновити summary результатів
        function updateResultsSummary() {
            document.getElementById('zipSummary').textContent = `ZIP: ${quizData.zipCode}`;
            document.getElementById('insuranceSummary').textContent = `Currently insured: ${quizData.insured === 'yes' ? 'Yes' : 'No'}`;
            
            if (quizData.bundle === 'yes') {
                document.getElementById('bundleSummary').textContent = 'Coverage: Car + Home Bundle';
                document.getElementById('bundleSummary').style.background = '#e8f5e8';
                document.getElementById('bundleSummary').style.color = '#2e7d32';
            } else {
                document.getElementById('bundleSummary').textContent = 'Coverage: Auto Insurance Only';
            }
        }

        // Оновити ціни
        function updatePricing() {
            document.querySelectorAll('.price-estimate').forEach(priceEl => {
                const autoPrice = parseInt(priceEl.dataset.auto);
                const bundlePrice = parseInt(priceEl.dataset.bundle);
                
                if (quizData.bundle === 'yes') {
                    priceEl.textContent = `$${bundlePrice}/month`;
                } else {
                    priceEl.textContent = `$${autoPrice}/month`;
                }
            });
        }

        // Оновити прогрес
        function updateProgress(step, completed = false) {
            const progress = completed ? 100 : (step / 3) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('currentStep').textContent = step;
        }

        // Відкрити афіліатне посилання
        function openOffer(company) {
            console.log('Opening offer for:', company, quizData);
            
            if (typeof gtag !== 'undefined') {
                gtag('event', 'offer_click', {
                    company: company,
                    zip_code: quizData.zipCode,
                    insured: quizData.insured,
                    bundle: quizData.bundle
                });
            }
            
            window.open(affiliateLinks[company], '_blank');
        }

        // Показати помилку
        function showError(message) {
            const existing = document.querySelector('.error-message');
            if (existing) existing.remove();
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            
            document.querySelector('.input-group').appendChild(errorDiv);
            setTimeout(() => errorDiv.remove(), 3000);
        }

        // Валідація ZIP коду (live typing)
        document.getElementById('zipCode').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '').substr(0, 5);
            e.target.value = value;
            
            const button = document.getElementById('zipBtn');
            if (value.length === 5) {
                if (isValidUSZipCode(value)) {
                    button.disabled = false;
                    button.textContent = 'Continue';
                    e.target.style.borderColor = '#4CAF50';
                } else {
                    button.disabled = true;
                    button.textContent = 'Invalid zip code';
                    e.target.style.borderColor = '#ff4757';
                }
            } else {
                button.disabled = true;
                button.textContent = 'Enter 5-digit zip code';
                e.target.style.borderColor = '#e0e0e0';
            }
        });

        // Enter key підтримка
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && document.getElementById('step1').classList.contains('active')) {
                goToStep2();
            }
        });

        // Ініціалізація
        document.addEventListener('DOMContentLoaded', function() {
            showCookieNotification();
            restoreProgress();
            
            setTimeout(() => {
                if (document.getElementById('step1').classList.contains('active')) {
                    document.getElementById('zipCode').focus();
                }
            }, 300);
        });

        console.log('ThePolicy quiz initialized with progress saving');
    </script>
</body>
</html>